{% extends "base.html" %}

{% block content %}
<h1 class="text-2xl font-bold text-gray-900 mb-4">
  –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –ó–ü –∑–∞ {{ month|date:"F Y" }}
  {% if report_type == "advance" %}(–ê–≤–∞–Ω—Å){% elif report_type == "final" %}(–ó–∞—Ä–ø–ª–∞—Ç–∞){% endif %}
</h1>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<form method="get" class="mb-6 flex flex-wrap gap-4 items-center">
  <label class="font-semibold text-gray-800">–ú–µ—Å—è—Ü:
    <input type="month" name="month" value="{{ month|date:'Y-m' }}"
           class="border rounded px-2 py-1 text-sm shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
  </label>

  <label class="font-semibold text-gray-800">–û—Ç–¥–µ–ª:
    <select name="department"
            class="border rounded px-2 py-1 text-sm shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
      <option value="">–í—Å–µ</option>
      {% for dept in departments %}
        <option value="{{ dept.id }}" {% if selected_department == dept.id|stringformat:"s" %}selected{% endif %}>
          {{ dept.name }}
        </option>
      {% endfor %}
    </select>
  </label>

  <label class="font-semibold text-gray-800">–¢–∏–ø:
    <select name="type"
            class="border rounded px-2 py-1 text-sm shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
      <option value="">–ü–æ–ª–Ω—ã–π</option>
      <option value="advance" {% if report_type == "advance" %}selected{% endif %}>–ê–≤–∞–Ω—Å</option>
      <option value="final" {% if report_type == "final" %}selected{% endif %}>–ó–∞—Ä–ø–ª–∞—Ç–∞</option>
    </select>
  </label>

  <button type="submit"
          class="px-4 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 text-sm font-semibold shadow">
    –ü–æ–∫–∞–∑–∞—Ç—å
  </button>
</form>

<!-- –¢–∞–±–ª–∏—Ü–∞ -->
<div class="overflow-x-auto border rounded shadow-sm">
  <table class="w-full border-collapse text-sm text-gray-800">
    <thead class="bg-gray-100 text-xs text-gray-700">
      <tr>
        <th class="border px-2 py-2 text-left">–§–ò–û</th>
        <th class="border px-2 py-2 text-left">–û—Ç–¥–µ–ª</th>
        <th class="border px-2 py-2 text-left">–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
        <th class="border px-2 py-2 text-center">–î–Ω–µ–≤–Ω—ã—Ö</th>
        <th class="border px-2 py-2 text-center">–ù–æ—á–Ω—ã—Ö</th>
        <th class="border px-2 py-2 text-center">–°–º–µ–Ω–∞ (‚ÇΩ)</th>
        <th class="border px-2 py-2 text-center">–£—Å–ª—É–≥–∏ (‚ÇΩ)</th>
        <th class="border px-2 py-2 text-center bg-green-100">–ò—Ç–æ–≥–æ (‚ÇΩ)</th>
      </tr>
    </thead>
    <tbody>
      {% for row in salary_summary %}
      <tr class="hover:bg-orange-50">
        <td class="border px-2 py-1 whitespace-nowrap">{{ row.employee.full_name }}</td>
        <td class="border px-2 py-1 whitespace-nowrap">{{ row.employee.department.name }}</td>
        <td class="border px-2 py-1 whitespace-nowrap">{{ row.employee.position.name }}</td>
        <td class="border px-2 py-1 text-center">{{ row.day }}</td>
        <td class="border px-2 py-1 text-center">{{ row.night }}</td>
        <td class="border px-2 py-1 text-right">{{ row.shifts_sum }}</td>
        <td class="border px-2 py-1 text-right">{{ row.services_sum }}</td>
        <td class="border px-2 py-1 text-right font-bold bg-green-50 text-green-800">
          {{ row.total }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- –í—ã–≥—Ä—É–∑–∫–∞ -->
<div class="mt-6">
  <a href="{% url 'export_salary_report' %}?month={{ month|date:'Y-m' }}{% if selected_department %}&department={{ selected_department }}{% endif %}"
     class="inline-block px-5 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-semibold shadow">
    üì• –í—ã–≥—Ä—É–∑–∏—Ç—å Excel-–æ—Ç—á—ë—Ç
  </a>
<a href="{% url 'export_salary_advance' %}?month={{ month|date:'Y-m' }}{% if selected_department %}&department={{ selected_department }}{% endif %}"
   class="inline-block px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold shadow">
  üì• –í—ã–≥—Ä—É–∑–∏—Ç—å –ê–≤–∞–Ω—Å
</a>

  <a href="{% url 'export_salary_full' %}?month={{ month|date:'Y-m' }}{% if selected_department %}&department={{ selected_department }}{% endif %}"
     class="inline-block px-5 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-semibold shadow">
    üì• –í—ã–≥—Ä—É–∑–∏—Ç—å –ó–∞—Ä–ø–ª–∞—Ç—É
  </a>
</div>
{% endblock %}
